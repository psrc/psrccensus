---
title: "Census estimates for non-census geographies"
description: >
  harnessing geographic splits for standard PSRC planning geographies
output: html_vignette
vignette: >
  %\VignetteIndexEntry{Census estimates for non-census geographies}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(knitr)
```

## Geographic precision and more meaningful geographies

Every Census Estimate is linked to a geography. However, not every geography is linked to a census estimate.

Since the Census Bureau cannot publish data at every conceivable scale, data users often approximate a custom boundary by choosing a set of disaggregate Census geographies (e.g. block, block group, or tract) that closely align with it.

Estimates more (apparently) precise than this involve assumptions. For PSRC's method, we use five OFM population and housing metrics distributed to parcels on the basis of housing stock: total population, household population, group quarters population, housing units, and occupied housing units. If we assume the spatial distribution of a Census estimate is directly proportional to one of these measures, a ratio can represent disaggregation of the estimate from Census geography to this granular scale and re-aggregation to the specific planning geography. That is the concept behind the following [set of functions] (reference/census_to_psrcgeo.html), which convert estimates from standard Census geographies to the following PSRC planning geographies:

  *  Regional Growth Strategy classes    - `census_to_rgs()`
  *  Regional Growth Centers             - `census_to_rgc()`
  *  Manufacturing-Industrial Centers    - `census_to_mic()`
  *  Traffic Analysis Zones              - `census_to_taz()`
  *  High Capacity Transit Station areas - `census_to_hct()`


These functions require only one argument, the name of the dataframe (as returned by `get_acs_recs()` or `get_dicennial_recs()`) you wish to convert.

```{r simple geographic conversion, message=FALSE}
library(psrccensus)
library(magrittr)

x <- get_acs_recs(geography = 'block group',
                  table.names = 'B03002',
                  years = 2021,
                  acs.type = 'acs5') %>% 
  dplyr::mutate(label=stringr::str_replace_all(label,"(^Estimate!!|Total:!!)",""))

x %>% dplyr::filter(variable=="B03002_012") %>% .[,c(1,5:8)] %>% head()

rgc_race <- census_to_rgc(x)

rgc_race %>% dplyr::filter(variable=="B03002_012") %>% .[,c(1,3,7:8)] %>% head()
                          
```

The default quantity used for splits is **total population**; if one of the other four quantities is more appropriate given your particular estimate of focus, you can specify it (using the `wgt` argument). If your dataframe combines tables that would most appropriately apply two different split quantities--for example, one linked to total population, and another linked to housing units--you might divide the dataframe (or alter your code to retrieve separate tables originally) before applying the geographic conversion. 

### Examples
As an example, to calculate 2019 median household income for the region you would use the following function calls:
```{r convert group quarters, message=FALSE, eval=FALSE}

y <- get_acs_recs(geography = 'tract',
                  table.names = 'B26001',
                  years = 2021,
                  acs.type = 'acs5') %>% 
  dplyr::mutate(label=stringr::str_replace_all(label,"(^Estimate!!|Total:!!)",""))

y %>% .[,c(1,4:8)] %>% head()

rgc_gq_age <- census_to_rgs(y, wgt="group_quarters_pop")

rgc_gq_age %>% .[,c(1:4,7:8)]

```

The set of planning geographies can be expanded as necessary (see the [documentation](http://aws-linux/mediawiki/index.php/Geography_Split_Tables_in_Elmer) - PSRC VPN required to view).

## Error margins & limitations

Currently, these split-derived calculations are limited to estimates only; it cannot correctly allocate medians. You can calculate shares by converting estimates of both the numerator and denominator to the appropriate geography. 

Although it may be harder to assume Margins of Error (MOE) are directly proportional to the split weight, the assumption is applied identically to estimate and MOE, which seemed the best option of those that came to mind.
