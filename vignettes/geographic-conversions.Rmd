---
title: "Census estimates for non-census geographies"
description: >
  harnessing geographic splits for standard PSRC planning geographies
output: html_vignette
vignette: >
  %\VignetteIndexEntry{Census estimates for non-census geographies}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(knitr)
```

## Geographic precision at more meaningful geographies

Every Census estimate is linked to a geography. However, not every geography is linked to a Census estimate.

Since the Census Bureau cannot publish data at every conceivable scale, data users often approximate a custom boundary by choosing a set of disaggregate Census geographies (e.g. block, block group, or tract) that closely align with it. 

Estimates more precise than this involve making some assumptions. Some metrics--such as housing stock--can be measured at a very granular level, i.e. parcel. If the distribution of a granular variable can plausibly be considered to be in direct proportion to the Census estimate of interest, we can then use the relative amounts of the proxy variable in the new geography versus the old geography to, in effect, disaggregate the estimate to parcel level and re-aggregate to the planning geography of interest. This is the concept behind the following [set of functions](reference/census_to_psrcgeo.html), which reference a stored set of fractions (per geography pair) to convert estimates from standard Census geographies to the following PSRC planning geographies:

  *  Regional Growth Strategy classes    - `census_to_rgs()`
  *  Regional Growth Centers             - `census_to_rgc()`
  *  Manufacturing-Industrial Centers    - `census_to_mic()`
  *  Traffic Analysis Zones              - `census_to_taz()`
  *  High Capacity Transit Station areas - `census_to_hct()`

There is only one required argument: the name of the dataframe (as returned by `get_acs_recs()` or `get_dicennial_recs()`) you wish to convert.

```{r simple geographic conversion, message=FALSE}
library(psrccensus)
library(magrittr)

x <- get_acs_recs(geography = 'block group',
                  table.names = 'B03002',
                  years = 2021,
                  acs.type = 'acs5') %>% 
  dplyr::mutate(label=stringr::str_replace_all(label,"(^Estimate!!|Total:!!)",""))

x %>% dplyr::filter(variable=="B03002_012") %>% .[,c(1,5:8)] %>% head()

rgc_race <- census_to_rgc(x)

rgc_race %>% dplyr::filter(variable=="B03002_012") %>% .[,c(1,3,7:8)] %>% head()

                          
```

## Selecting the correct splitter metric

The key assumption behind this method is the direct relationship between the granular "splitter" metric, and the Census variable of interest; the stronger this relationship, the more defensible the result. With housing stock as the basis, PSRC has disaggregated several OFM metrics to the parcel level:

  *  **Total population** - The default splitter metric
  *  **Household population** - Those living in conventional housing, e.g. houses, apartments, mobile homes, or rented rooms
  *  **Group quarters population** - Those living in shared facilities, such as dorms, barracks, nursing homes, or prisons
  *  **Housing units**
  *  **Occupied housing units** 

Before splitting a geography, consider which metric is most relevant to your Census estimate of interest. Aside from **total population**, these must be specified using the `wgt` argument, as illustrated below:

```{r convert group quarters, message=FALSE}

y <- get_acs_recs(geography = 'tract',
                  table.names = 'B26001',
                  years = 2021,
                  acs.type = 'acs5') %>% 
  dplyr::mutate(label=stringr::str_replace_all(label,"(^Estimate!!|Total:!!)",""))

y %>% .[,c(1,5:8)] %>% head()

rgc_gq_age <- census_to_rgs(y, wgt="group_quarters_pop")

rgc_gq_age %>% .[,c(1,3,4,7,8)]


```
If your dataframe combines tables that would most appropriately apply two different splitter metrics--for example, one linked to total population, and another linked to housing units--you might divide the dataframe (or alter your code to retrieve separate tables originally) before applying the geographic conversion. 

## Error margins & limitations

Currently, split-derived calculations are limited to estimates only; medians cannot be determined via this method. Analysts can calculate shares by converting estimates of both the numerator and denominator to the appropriate geography.

Although it may be harder to assume Margins of Error (MOE) are directly proportional to the split weight, the assumption is applied identically to both estimate and MOE, which seemed the best choice of the available options.


## Further geographies

The set of planning geographies is not strictly limited to the five listed above; with approval, the set can be expanded (see the [documentation](http://aws-linux/mediawiki/index.php/Geography_Split_Tables_in_Elmer) - PSRC VPN required to view). We realize there is also a need to split Census estimates using custom geographies besides those central to PSRC's own planning (such as those involved in jurisdictional data requests). We are considering several methods to do this and in the future will update this page with links to documentation of those methods.
